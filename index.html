<!doctype html>
<meta charset="utf-8">
<title>Routing Board Game</title>
<style>
  html,body {margin:0;height:100%}
  body {background:#111}
  #hud {position:fixed;left:8px;top:8px;color:#cfcfd4;font:12px/1.35 -apple-system,Segoe UI,Arial,sans-serif;background:rgba(0,0,0,0.28);padding:8px 10px;border-radius:6px;max-width:360px}
  #hud h2 {margin:0 0 6px 0;font:600 12px/1.2 -apple-system,Segoe UI,Arial,sans-serif;color:#e6e6ea}
  #hud ul {margin:6px 0 0 16px;padding:0}
  #hud li {margin:2px 0}
  .kbd {padding:1px 4px;border-radius:3px;background:#222;color:#ddd;border:1px solid #333;font:11px/1.2 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .sep {opacity:.6}
  .small {font-size:11px}
  .btn {padding:4px 8px;border-radius:4px;background:#27272d;color:#e6e6ea;border:1px solid #3a3a3f;cursor:pointer}
  .btn:hover {background:#2f2f36}
  .btn:active {background:#26262d}
  .btn-row {display:flex;flex-wrap:wrap;gap:6px;margin:6px 0}
  .btn-row label {display:flex;align-items:center;gap:6px;color:#cfcfd4}
  .btn-row input {width:56px;padding:4px;background:#1b1b1f;border:1px solid #2f2f36;color:#e6e6ea;border-radius:3px}
  #mode {display:inline-flex;align-items:center;padding:2px 8px;border-radius:999px;border:1px solid #3a3a3f;background:#2a2a30;color:#d8d8e0;font-weight:600}
  body[data-mode="routing"] #mode {background:#1f3b2b;color:#c2f5d0;border-color:#2f5c3c}
  body[data-mode="placement"] #mode {background:#3b2b2b;color:#f1c3c3;border-color:#5c3c3c}
  body[data-mode="routing"] #btnMode {background:#24442f;border-color:#31573f}
  body[data-mode="placement"] #btnMode {background:#3a3030;border-color:#5a4141}
  #editLock {display:inline-flex;align-items:center;padding:2px 8px;border-radius:999px;border:1px solid #3a3a3f;background:#2a2a30;color:#d8d8e0;font-weight:600}
  body[data-edit="locked"] #editLock {background:#3b2b2b;color:#f1c3c3;border-color:#5c3c3c}
  body[data-edit="unlocked"] #editLock {background:#1f3b2b;color:#c2f5d0;border-color:#2f5c3c}
  canvas {width:100vw;height:100vh;display:block}
</style>
<div id="hud">
  <h2>Routing Board Game</h2>
  <div class="small">Set each tile's arrow to route all pieces to the top output in the fewest turns — lower score wins.</div>
  <div class="small">Mode: <span id="mode">Placement</span> <span class="sep">•</span> <span class="kbd">M</span> toggle mode <span class="sep">•</span> Edit: <span id="editLock">Locked</span> (<span class="kbd">L</span>)</div>
  <h2>Objective</h2>
  <ul>
    <li>Route all pieces to the top output tile in as few <b>turns</b> as possible.</li>
    <li><b>Score</b> = Turns + 2 × Eaten (lower is better).</li>
  </ul>
  <h2>Modes</h2>
  <ul>
    <li><b>Placement</b>: click tiles to add/remove pieces (one per tile).</li>
    <li><b>Routing</b>: click tiles to set the <b>arrow direction</b>; <span class="kbd">Shift</span>+Click cycles the direction backward.</li>
  </ul>
  <h2>Rules</h2>
  <ul>
    <li>Every turn, each piece moves one tile along its cell’s arrow.</li>
    <li>Pieces on the output tile are removed at the start of the next turn.</li>
    <li>Collisions: if multiple pieces enter a tile, one survives (shown <span class="kbd">red</span> that turn), others are eaten (+2 score each).</li>
  </ul>
  <h2>Controls</h2>
  <div class="btn-row">
    <button id="btnMode" class="btn">Toggle mode (M)</button>
    <button id="btnRun" class="btn">Run / Pause (Space)</button>
    <button id="btnStep" class="btn">Step (S)</button>
    <button id="btnBack" class="btn">Undo step (Z)</button>
    <button id="btnReset" class="btn">Reset (R)</button>
    <button id="btnClearPieces" class="btn">Clear pieces (C)</button>
    <button id="btnClearRoutes" class="btn">Clear routes (D)</button>
    <button id="btnLock" class="btn">Unlock editing (L)</button>
  </div>
  <div class="btn-row">
    <label>Random pieces
      <input id="randPiecesCount" type="number" min="1" max="10" value="5">
    </label>
    <button id="btnRandPieces" class="btn">Place (1-9,0)</button>
    <button id="randomRoutes" class="btn">Randomize routes</button>
  </div>
  <div class="small">Keyboard shortcuts still work for power users.</div>
</div>
<canvas id="c"></canvas>
<script type="module" src="main.js"></script>
